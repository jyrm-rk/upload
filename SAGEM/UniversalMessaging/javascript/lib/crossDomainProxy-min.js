var clientWindow=null;var clientOrigin=null;var xhr=new XMLHttpRequest();var sessionID=getUrlParameter("sessionID");var proxyID=getUrlParameter("proxyID");var validOrigins=getUrlParameter("validOrigins").split(",");var expired=getUrlParameter("expired");var iFrame=null;var source=null;var isClosed=false;var debugMode=false;function clientMessageHandler(f){if(!isValidOrigin(f.origin)){return;}clientOrigin=f.origin;clientWindow=f.source;var b=JSON.parse(f.data);var d=b[1];var a=b.slice(2);if(d=="createForeverIFrame"){createForeverIFrame(a);}else{if(d=="createEventSource"){createEventSource(a);}else{if(d=="abort"){isClosed=true;xhr[d].apply(xhr,a);if(iFrame!==null){if(iFrame.close){iFrame.close();}}if(source!==null){source.close();}}else{xhr[d].apply(xhr,a);}}}}if(!expired){window.addEventListener("message",clientMessageHandler);xhr.onreadystatechange=function(){try{clientWindow.postMessage(JSON.stringify([proxyID,sessionID,"change",xhr.responseText,xhr.readyState,xhr.status]),clientOrigin);}catch(a){}};}function onMessage(a){try{clientWindow.postMessage(JSON.stringify([proxyID,sessionID,"iframe",JSON.stringify(a)]),clientOrigin);}catch(b){}}function errorCB(){try{clientWindow.postMessage(JSON.stringify([proxyID,sessionID,"iFrame_close"]),clientOrigin);}catch(b){}try{if(navigator.appName=="Microsoft Internet Explorer"){while(iFrame.hasChildNodes()){iFrame.removeChild(iFrame.lastChild);}}else{while(iFrame.hasChildNodes()){var a=iFrame.removeChild(iFrame.lastChild);for(var d in a){delete a[d];}}}iFrame.parentWindow.removeChild(iFrame);}catch(b){}try{iFrame.parentWindow.document.removeChild(iFrame);}catch(b){}}function onHTMLFileMessage(a){try{clientWindow.postMessage(JSON.stringify([proxyID,sessionID,"iframe",JSON.stringify(a)]),clientOrigin);}catch(b){}}function onEventSourceMessage(a){try{if(a){clientWindow.postMessage(JSON.stringify([proxyID,sessionID,"sse",a]),clientOrigin);}}catch(b){}}function onIframeMessage(a){try{if(a){clientWindow.postMessage(JSON.stringify([proxyID,sessionID,"iframe",a]),clientOrigin);}}catch(b){}}function start(){window.parent.postMessage(JSON.stringify([proxyID,sessionID,"init"]),"*");}start();function createXHR(){}function createForeverIFrame(d){d=d.join("");if(iFrame===null&&!isClosed){if(document.createElement){var e=document.getElementById("NVLSubFrame");if(e){e.setAttribute("src",d);iFrame=e;}else{var a='<iframe id="NVLSubFrame" onload="try{errorCB()}catch(e){}" src="'+d+'" style="';a+="border:1px;";a+="width:0px;";a+="height:0px;";a+='"></iframe>';if(window.ActiveXObject){this.htmlfile=new ActiveXObject("htmlfile");this.htmlfile.open();this.htmlfile.write("<html></html>");this.htmlfile.close();this.htmlfile.parentWindow.onMessage=onHTMLFileMessage;this.htmlfile.parentWindow.errorCB=errorCB;var b=this.htmlfile.createElement("div");this.htmlfile.body.appendChild(b);b.innerHTML+=a;iFrame=this.htmlfile;}else{document.getElementById("SUBFRAMEHOLDER").innerHTML=a;iFrame={};iFrame.document={};iFrame.document.location={};iFrame.document.location.iframe=document.getElementById("NVLSubFrame");iFrame.document.location.replace=function(f){this.iframe.src=f;};}}}}}function createEventSource(a){a=a.join("");source=new EventSource(a);source.onmessage=function(d){var b=d.data;onEventSourceMessage(b);};source.onerror=function(b){if(b.readyState==EventSource.CLOSED){clientWindow.postMessage(JSON.stringify([proxyID,sessionID,"SSE_close"]),clientOrigin);}else{clientWindow.postMessage(JSON.stringify([proxyID,sessionID,"SSE_error"]),clientOrigin);}source.close();};}function isValidOrigin(a){a=getCanonicalOrigin(a).toUpperCase();for(var b=0;b<validOrigins.length;b++){if(a==validOrigins[b].toUpperCase()){return true;}}return false;}function getCanonicalOrigin(a){a=a.match(/^https?:\/\/[^\/]+/)[0];if(!a.match(/:[0-9]+$/)){if(a.match(/^https:/)){a+=":443";}else{a+=":80";}}return a;}function getUrlParameter(b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a="[\\?&]"+b+"=([^&#]*)";var e=new RegExp(a);var d=e.exec(window.location.href);if(d===null){return"";}else{return unescape(d[1]);}}function c(b){try{clientWindow.postMessage(JSON.stringify([proxyID,sessionID,"change",b,4,200]),clientOrigin);}catch(a){}}